<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides a wrapper around lme4::lmer to allow for multimembership
    random effects. Includes helper functions for creating weight matrices.">
<title>Multiple membership random effects • lmerMultiMember</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Multiple membership random effects">
<meta property="og:description" content="Provides a wrapper around lme4::lmer to allow for multimembership
    random effects. Includes helper functions for creating weight matrices.">
<meta property="og:image" content="https://jvparidon.github.io/lmerMultiMember/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@jvparidon">
<meta name="twitter:site" content="@jvparidon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">lmerMultiMember</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/group_membership.html">Group membership models using lmerMultiMember</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jvparidon/lmerMultiMember/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="lmermultimember-">lmerMultiMember 
<a class="anchor" aria-label="anchor" href="#lmermultimember-"></a>
</h1>
</div>
<p>Wrapper around <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer</a></code> and <code><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">lme4::glmer</a></code> to add support for multiple membership random effects.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The package is not yet available on CRAN, but you can install it with the devtools package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"jvparidon/lmerMultiMember"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-is-a-multimembership-random-effect">What is a multimembership random effect?<a class="anchor" aria-label="anchor" href="#what-is-a-multimembership-random-effect"></a>
</h3>
<p>Let’s take authorship as an example: If we want to model some aspect of published journal articles, e.g. <code>citations ~ word_count</code>, we might want to account for variability caused by the authors of papers by using random intercepts. However, many papers don’t have just a single author. How do we account for author variability then?</p>
<p>One method could be to model each unique grouping of authors as a separate level of the random effect (i.e. “John A”, “Mary B”, “John A &amp; Mary B”, and “Mary B &amp; John A” are four different levels of the random effect) but this has the downside of not correctly attributing the variance to the individual authors in the groups.</p>
<p>Another option is to have separate random effects for each position in the author list (i.e. <code>(1|author1) + (1|author2) + (1|author3)</code> etc.) but while this does treat each author as a separate entity, it treats the same author as different people depending on where they occur in the author list, which is also a little strange.</p>
<p>The most natural option would be to associate each observation (journal article) with multiple levels (authors) of a single random effect. This is a multimembership random effect.</p>
</div>
<div class="section level3">
<h3 id="how-to-specify-a-multimembership-random-effect">How to specify a multimembership random effect<a class="anchor" aria-label="anchor" href="#how-to-specify-a-multimembership-random-effect"></a>
</h3>
<p>Specifying a multimembership model in <code>lmerMultiMember</code> works just like specifying any other mixed effects model in <code>lme4</code>, with the addition of a membership matrix (or weight matrix). This sparse matrix contains rows for all the observations in your dataset and columns for each unique group member. For each observation, the matrix contains 1s for all the group members associated with it, with 0s everywhere else. (If group members should not have equal association strength, the 1s in the membership matrix can, in principle, be replaces with fractions to represent relative contributions, etc.) The model syntax could then be e.g. <code>lmerMultiMember::lmer(citations ~ word_count + (1|author), memberships=list(author=membership_matrix))</code>.</p>
<p>Creating a membership matrix might seem a little daunting, but we provide a helper function <code><a href="reference/weights_from_vector.html">lmerMultiMember::weights_from_vector</a></code> that creates a membership matrix from a vector of group memberships in comma-separated strings (e.g. <code>c("A,B", "A,B,C", "B", "C,A")</code>) so if you have group memberships documented in your dataset it should be easy enough to create a membership matrix for you model.</p>
</div>
<div class="section level3">
<h3 id="nested-random-effects-groupings-work-a-little-differently">Nested random effects groupings work a little differently<a class="anchor" aria-label="anchor" href="#nested-random-effects-groupings-work-a-little-differently"></a>
</h3>
<p><code>lmerMultiMember</code> uses dummy variables and fake factors internally to ‘trick’ <code>lme4</code> into accepting multiple membership random effects. Unfortunately, that system of dummies and fakes means that you can’t specify a nested multimembership random effects grouping using the normal formula syntax. For example, <code>lmer(citations ~ word_count + (1 | author/journal), memberships = list(author = membership_matrix))</code> will throw an error, because the multiple membership author variable cannot be nested inside the journal grouping.</p>
<p>The solution for this issue is to pre-generate an indicator/weight matrix for the nested grouping using the provided <code><a href="reference/interaction_weights.html">lmerMultiMember::interaction_weights()</a></code> function. For example, given a dataframe <code>df</code> with multimembership <code>author</code> and single membership <code>journal</code> grouping variables, in order to get nested groupings, we could do the following:</p>
<pre><code><span><span class="va">Wa</span> <span class="op">&lt;-</span> <span class="fu">weights_from_vectors</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">author</span><span class="op">)</span></span>
<span><span class="va">Wj</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparse.model.matrix.html" class="external-link">fac2sparse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">journal</span><span class="op">)</span>  <span class="co"># convert single membership vars to an indicator matrix with fac2sparse()</span></span>
<span><span class="va">Waj</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/interaction_weights.html">interaction_weights</a></span><span class="op">(</span><span class="va">Wa</span>, <span class="va">Wj</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/lmer.html">lmer</a></span><span class="op">(</span><span class="va">citations</span> <span class="op">~</span> <span class="va">word_count</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">author</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">authorXjournal</span><span class="op">)</span>, memberships <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>author <span class="op">=</span> <span class="va">Wa</span>, authorXjournal <span class="op">=</span> <span class="va">Waj</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h3>
<p>If you have any issues fitting models with <code>lmerMultiMember</code>, feel free to contact Jeroen van Paridon at <a href="mailto:vanparidon@wisc.edu">vanparidon@wisc.edu</a>.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/jvparidon/lmerMultiMember/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/jvparidon/lmerMultiMember/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing lmerMultiMember</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://jvparidon.io" class="external-link">JP van Paridon</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5384-8772" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Ben Bolker <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-2127-0443" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://phillipalday.com" class="external-link">Phillip Alday</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9984-5745" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/jvparidon/lmerMultiMember/actions" class="external-link"><img src="https://github.com/jvparidon/lmerMultiMember/actions/workflows/r.yml/badge.svg" alt="build"></a></li>
<li><a href="https://codecov.io/gh/jvparidon/lmerMultiMember" class="external-link"><img src="https://codecov.io/gh/jvparidon/lmerMultiMember/branch/main/graph/badge.svg" alt="codecov"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://jvparidon.io" class="external-link">JP van Paridon</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
